#/**************************************************************************
# * Kevin 2014-02-24                                                       *
# **************************************************************************/

#---------------------------------------------------------------------------
# Constant Variable definition
#---------------------------------------------------------------------------
ROOT = ../..
include $(ROOT)/Tools/tool_chain.def 
LIB_DIR =	$(ROOT)/Lib/$(LIBDIR)
#---------------------------------------------------------------------------
# Target definition (User)
#---------------------------------------------------------------------------
GOAL  = $(LIB_DIR)/wifi.a

#---------------------------------------------------------------------------
# Source section (User)
#---------------------------------------------------------------------------
ASM_SRC		+= 
C_SRC		+= $(ROOT)/App/wm_main.c
C_SRC		+= $(ROOT)/App/wm_atcmd/wm_cmdp.c
C_SRC		+= $(ROOT)/App/wm_atcmd/wm_cmdp_at.c
C_SRC		+= $(ROOT)/App/wm_atcmd/wm_cmdp_hostif.c
C_SRC		+= $(ROOT)/App/wm_atcmd/wm_cmdp_ri.c
C_SRC		+= $(ROOT)/App/wm_atcmd/wm_hspi_task.c
C_SRC		+= $(ROOT)/App/wm_atcmd/wm_uart_task.c
C_SRC		+= $(ROOT)/App/wm_atcmd/wm_uart_timer.c
C_SRC		+= $(ROOT)/App/oneshotconfig/wm_wifi_oneshot.c

#---------------------------------------------------------------------------
# Link Library Section
#---------------------------------------------------------------------------
LIB_SRC += $(LIB_DIR)/wlan.a
LIB_SRC += $(LIB_DIR)/wmsys.a
LIB_SRC += $(LIB_DIR)/wmlitepoint.a

#---------------------------------------------------------------------------
# Implicit rules
#---------------------------------------------------------------------------
.c.o:
	@$(ECHO) "Compiling $<..."
	@$(CC) $(CCFLAGS) -c -o $*.o $< $(INCLUDE_DIR)

.s.o:
	@$(ECHO) "Compiling $<..."
	@$(ASM) $(ASMFLAGS) -c -o $*.o $< $(INCLUDE_DIR)

#---------------------------------------------------------------------------
# Explicit ruls
#---------------------------------------------------------------------------
OBJ_FILES	= $(C_SRC:%.c=%.o) $(ASM_SRC:%.s=%.o)

all: $(GOAL)

$(GOAL): $(OBJ_FILES) $(LIB_SRC)
	@$(AR) $(ARFLAGS) $@ $(OBJ_FILES)
	@$(ECHO) "***" $(GOAL) "is built successfully! ***"
	@$(ECHO) "---------"
	@rm -f $(OBJ_FILES:.o=.d) $(OBJ_FILES)

.PHONY: clean
clean:
	@rm -f $(GOAL)
	@rm -f $(OBJ_FILES:.o=.d) $(OBJ_FILES)
	
